<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙƒØ´ÙƒÙˆÙ„ÙŠ - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„ÙƒØ§Ù…Ù„</title>
    <style>
        /* Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Tajawal', sans-serif;
        }

        body {
            background: #f8f9fa;
            color: #2c3e50;
        }

        header {
            background: #2c3e50;
            color: white;
            padding: 1rem;
            position: fixed;
            top: 0;
            width: 100%;
            height: 60px;
            z-index: 1000;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        main {
            margin-top: 60px;
            padding: 20px;
            min-height: calc(100vh - 60px);
        }

        /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£Ø¯ÙˆØ§Øª */
        .toolbar {
            position: fixed;
            top: 60px;
            background: white;
            padding: 10px 20px;
            width: 100%;
            z-index: 999;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            min-width: 60px;
            transition: all 0.2s;
        }

        button:hover {
            opacity: 0.9;
            transform: scale(0.98);
        }

        /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
        #editor {
            background: white;
            min-height: 500px;
            padding: 30px;
            border-radius: 10px;
            margin-top: 130px;
            line-height: 1.6;
            font-size: 18px;
            border: 1px solid #ddd;
            outline: none;
        }

        .title-box {
            background: #ecf0f1;
            border-right: 4px solid #3498db;
            padding: 15px;
            margin: 20px 0;
        }

        .question-box {
            background: #fcf3cf;
            border-right: 4px solid #f1c40f;
            padding: 15px;
            margin: 20px 0;
        }

        .answer-box {
            background: #d4efdf;
            border-right: 4px solid #2ecc71;
            padding: 15px;
            margin: 20px 0;
        }

        /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„ØµÙˆØ± */
        .image-card {
            display: inline-block;
            width: 150px;
            height: 150px;
            margin: 5px;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s;
            border: 1px solid #ddd;
        }

        .image-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-card:hover {
            transform: scale(1.05);
        }

        /* Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø© Ø§Ù„Ø´Ø§Ø´Ø© */
        .fullscreen-image {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.97);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .fullscreen-image img {
            max-width: 90%;
            max-height: 80%;
            object-fit: contain;
            cursor: zoom-out;
        }

        /* Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ØµÙˆØ±Ø© */
        .image-controls {
            position: fixed;
            bottom: 20px;
            display: flex;
            gap: 10px;
        }

        .control-btn {
            background: rgba(255,255,255,0.9);
            color: #333;
            border: none;
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* ÙˆØ¶Ø¹ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© */
        .reading-mode-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            z-index: 2000;
            padding: 60px 20px 20px;
            overflow-y: auto;
        }

        .close-reading-mode {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #e74c3c;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <header><h1>ÙƒØ´ÙƒÙˆÙ„ÙŠ</h1></header>

    <main>
        <!-- ØµÙØ­Ø© Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© -->
        <section id="foldersPage">
            <h2>Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</h2>
            <div id="foldersList"></div>
            <button onclick="addFolder()">+ Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
        </section>

        <!-- ØµÙØ­Ø© Ø§Ù„Ø¯Ø±ÙˆØ³ -->
        <section id="lessonsPage" style="display:none;">
            <button onclick="showPage('foldersPage')">â† Ø§Ù„Ø±Ø¬ÙˆØ¹</button>
            <h2 id="currentFolderTitle"></h2>
            <div id="lessonsList"></div>
            <button onclick="addLesson()">+ Ø¯Ø±Ø³ Ø¬Ø¯ÙŠØ¯</button>
        </section>

        <!-- ØµÙØ­Ø© Ø§Ù„Ù…Ø­Ø±Ø± -->
        <section id="editorPage" style="display:none;">
            <button onclick="showPage('lessonsPage')">â† Ø§Ù„Ø±Ø¬ÙˆØ¹</button>
            <h2 id="lessonTitle"></h2>

            <div class="toolbar">
                <button onclick="insertTemplate('title-box', 'Ø¹Ù†ÙˆØ§Ù† Ø¬Ø¯ÙŠØ¯')">ğŸ“Œ Ø¹Ù†ÙˆØ§Ù†</button>
                <button onclick="insertTemplate('question-box', 'Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯')">â“ Ø³Ø¤Ø§Ù„</button>
                <button onclick="insertTemplate('answer-box', 'Ø¥Ø¬Ø§Ø¨Ø©')">ğŸ’¡ Ø¥Ø¬Ø§Ø¨Ø©</button>
                <button onclick="execCommand('bold')">Ø¹Ø±ÙŠØ¶</button>
                <button onclick="execCommand('italic')">Ù…Ø§Ø¦Ù„</button>
                <button onclick="execCommand('underline')">ï¹</button>
                <input type="color" onchange="changeTextColor(this.value)">
                <input type="color" id="highlighterColor" onchange="setHighlighterColor(this.value)">
                <button onclick="applyHighlight()">ğŸ–ï¸ ØªÙ…ÙŠÙŠØ²</button>
                <input type="file" id="imageInput" accept="image/*" hidden>
                <button onclick="document.getElementById('imageInput').click()">ğŸ–¼ï¸ ØµÙˆØ±Ø©</button>
                <button onclick="toggleReadingMode()">ğŸ“– Ù‚Ø±Ø§Ø¡Ø©</button>
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù†Øµ..." oninput="highlightSearch()">
                    <button onclick="prevHighlight()">â€¹</button>
                    <button onclick="nextHighlight()">â€º</button>
                </div>
            </div>

            <div id="editor" contenteditable="true"></div>
        </section>
    </main>

    <script>
        // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØªØ®Ø²ÙŠÙ†
        let folders = JSON.parse(localStorage.getItem('folders')) || [];
        let currentFolderIndex = null;
        let currentLessonIndex = null;
        let highlightColor = '#ffff00';
        let searchHighlights = [];
        let currentHighlightIndex = -1;

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙØ­Ø§Øª
        function showPage(pageId) {
            document.querySelectorAll('section').forEach(s => s.style.display = 'none');
            document.getElementById(pageId).style.display = 'block';
        }

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¯
        function addFolder() {
            const name = prompt('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©:');
            if (name) {
                folders.push({ name, lessons: [] });
                saveData();
                renderFolders();
            }
        }

        function renderFolders() {
            const list = document.getElementById('foldersList');
            list.innerHTML = folders.map((folder, index) => `
                <div class="folder" onclick="openFolder(${index})">
                    ${folder.name}
                    <div class="actions">
                        <button onclick="event.stopPropagation(); editFolder(${index})">âœï¸</button>
                        <button onclick="event.stopPropagation(); deleteFolder(${index})">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `).join('');
        }

        function openFolder(index) {
            currentFolderIndex = index;
            document.getElementById('currentFolderTitle').textContent = folders[index].name;
            renderLessons();
            showPage('lessonsPage');
        }

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯Ø±ÙˆØ³
        function addLesson() {
            const name = prompt('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¯Ø±Ø³:');
            if (name) {
                folders[currentFolderIndex].lessons.push({ name, content: '' });
                saveData();
                renderLessons();
            }
        }

        function renderLessons() {
            const list = document.getElementById('lessonsList');
            list.innerHTML = folders[currentFolderIndex].lessons.map((lesson, index) => `
                <div class="lesson" onclick="openLesson(${index})">
                    ${lesson.name}
                    <div class="actions">
                        <button onclick="event.stopPropagation(); editLesson(${index})">âœï¸</button>
                        <button onclick="event.stopPropagation(); deleteLesson(${index})">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `).join('');
        }

        function openLesson(index) {
            currentLessonIndex = index;
            const lesson = folders[currentFolderIndex].lessons[index];
            document.getElementById('lessonTitle').textContent = lesson.name;
            document.getElementById('editor').innerHTML = lesson.content;
            initEditorImages();
            showPage('editorPage');
        }

        // Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ø­Ø±Ø±
        function insertTemplate(className, placeholder) {
            const sel = window.getSelection();
            if (sel.rangeCount === 0) return;
            
            const range = sel.getRangeAt(0);
            const div = document.createElement('div');
            div.className = className;
            div.contentEditable = true;
            div.innerHTML = placeholder;
            
            range.deleteContents();
            range.insertNode(div);
            range.setStartAfter(div);
            sel.removeAllRanges();
            sel.addRange(range);
            saveContent();
        }

        function execCommand(cmd) {
            document.execCommand(cmd);
            saveContent();
        }

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙˆØ±
        document.getElementById('imageInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            if (file.size > 5 * 1024 * 1024) {
                alert('Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© 5MB');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const container = document.createElement('div');
                container.className = 'image-card';
                
                const img = new Image();
                img.src = e.target.result;
                img.onclick = () => showFullscreenImage(img.src);
                
                container.appendChild(img);
                
                const sel = window.getSelection();
                const range = sel.getRangeAt(0);
                range.insertNode(container);
                range.setStartAfter(container);
                
                saveContent();
            };
            reader.readAsDataURL(file);
        });

        function showFullscreenImage(src) {
            const overlay = document.createElement('div');
            overlay.className = 'fullscreen-image';
            overlay.onclick = () => overlay.remove();

            const img = new Image();
            img.src = src;
            
            const controls = document.createElement('div');
            controls.className = 'image-controls';
            
            controls.innerHTML = `
                <button class="control-btn" onclick="zoomImage(1.2)">â•</button>
                <button class="control-btn" onclick="zoomImage(0.8)">â–</button>
                <button class="control-btn" onclick="rotateImage(90)">ğŸ”„</button>
            `;

            overlay.appendChild(img);
            overlay.appendChild(controls);
            document.body.appendChild(overlay);
        }

        // Ù…ÙŠØ²Ø© Ø§Ù„Ø¨Ø­Ø«
        function highlightSearch() {
            const text = document.getElementById('searchInput').value.trim();
            const editor = document.getElementById('editor');
            
            editor.innerHTML = editor.innerHTML.replace(/<span class="highlight">/g, '');
            searchHighlights = [];
            
            if (!text) return;
            
            const regex = new RegExp(`(${text})`, 'gi');
            editor.innerHTML = editor.innerHTML.replace(regex, '<span class="highlight">$1</span>');
            
            searchHighlights = [...document.getElementsByClassName('highlight')];
            if (searchHighlights.length > 0) {
                currentHighlightIndex = 0;
                searchHighlights[0].scrollIntoView();
            }
        }

        // Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        function saveContent() {
            if (currentFolderIndex !== null && currentLessonIndex !== null) {
                folders[currentFolderIndex].lessons[currentLessonIndex].content = 
                    document.getElementById('editor').innerHTML;
                saveData();
            }
        }

        function saveData() {
            localStorage.setItem('folders', JSON.stringify(folders));
        }

        // Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
        window.onload = () => {
            renderFolders();
            showPage('foldersPage');
            
            // Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 10 Ø«ÙˆØ§Ù†ÙŠ
            setInterval(saveContent, 10000);
            
            // Ø§Ù„Ø­ÙØ¸ Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©
            window.addEventListener('beforeunload', saveContent);
        };
    </script>
</body>
</html>
