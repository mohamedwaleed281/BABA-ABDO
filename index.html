<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ÙƒØ´ÙƒÙˆÙ„ÙŠ</title>
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      margin: 0; padding: 0;
      background-color: #f4f9f9;
      color: #333;
      direction: rtl;
      height: 100vh;
      overflow: hidden;
    }
    /* ØµÙØ­Ø§Øª Ø§Ù„ØªÙ†Ù‚Ù„ */
    #foldersPage, #lessonsPage {
      padding: 1rem;
      height: calc(100vh - 0);
      overflow-y: auto;
    }
    .folder, .lesson {
      background-color: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 0.75rem 1rem;
      margin: 0.5rem 0;
      position: relative;
      cursor: pointer;
    }
    .folder .actions, .lesson .actions {
      position: absolute;
      left: 10px; top: 50%;
      transform: translateY(-50%);
    }
    .actions button {
      background: none; border: none;
      font-size: 1rem; cursor: pointer;
      margin-right: 5px;
    }
    button {
      background-color: #4db6ac;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      cursor: pointer;
      margin: 0.25rem;
    }
    .hidden { display: none; }
    /* Ù…Ø­Ø±Ø± Ø§Ù„Ø¯Ø±Ø³ */
    #editorPage {
      display: none;
      position: relative;
      height: 100vh;
      background-color: #f4f9f9;
    }
    /* Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª */
    #editorToolbar {
      position: fixed;
      top: 0; left: 0; right: 0;
      background: #4db6ac;
      display: flex; gap: 0.5rem;
      padding: 0.5rem; z-index: 100;
    }
    #editorToolbar button,
    #editorToolbar input[type=color],
    #editorToolbar input[type=text] {
      background: white; color: #333;
      border: none; padding: 0.5rem;
      border-radius: 4px; cursor: pointer;
    }
    /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø© */
    #editor {
      position: absolute;
      top: 50px; bottom: 0;
      left: 0; right: 0;
      padding: 1rem;
      overflow-y: auto;
      background-color: white;
    }
    .title-box {
      background-color: #dcedc8;
      border-left: 5px solid #8bc34a;
      padding: 0.5rem; margin: 0.5rem 0;
      font-weight: bold;
    }
    .question-box {
      background-color: #fff3cd;
      border-right: 5px solid #ffc107;
      padding: 0.5rem; margin: 1rem 0 0.5rem;
      font-weight: bold;
    }
    .answer-box {
      background-color: #e3f2fd;
      border-right: 5px solid #2196f3;
      padding: 0.5rem; margin: 0 0 1rem;
    }
    .editable-paragraph {
      margin: 10px 0;
      min-height: 20px;
      outline: none;
    }
    mark { background-color: yellow; }
    .fullscreen-overlay {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex; align-items: center; justify-content: center;
      z-index: 9999;
    }
    .fullscreen-overlay img {
      max-width: 90%; max-height: 90%;
    }
    .close-button {
      position: absolute; top: 10px; right: 20px;
      background-color: #f44336; color: white;
      border: none; padding: 0.5rem 1rem;
      border-radius: 5px; cursor: pointer;
    }
  </style>
</head>
<body>

  <!-- ØµÙØ­Ø© Ø§Ù„Ù…ÙˆØ§Ø¯ -->
  <section id="foldersPage">
    <h2>Ù…ÙˆØ§Ø¯Ùƒ</h2>
    <div id="foldersList"></div>
    <button onclick="addFolder()">+ Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
  </section>

  <!-- ØµÙØ­Ø© Ø§Ù„Ø¯Ø±ÙˆØ³ -->
  <section id="lessonsPage" class="hidden">
    <button onclick="backToFolders()">â—€ï¸ Ø§Ù„Ù…ÙˆØ§Ø¯</button>
    <h2 id="currentFolderTitle"></h2>
    <div id="lessonsList"></div>
    <button onclick="addLesson()">+ Ø¯Ø±Ø³ Ø¬Ø¯ÙŠØ¯</button>
  </section>

  <!-- ØµÙØ­Ø© ØªØ­Ø±ÙŠØ± Ø§Ù„Ø¯Ø±Ø³ -->
  <section id="editorPage">
    <div id="editorToolbar">
      <button onclick="backToLessons()">â—€ï¸ Ø§Ù„Ø¯Ø±ÙˆØ³</button>
      <button onclick="insertAtCursor('<div class=\\'title-box\\' contenteditable=\\'true\\'>Ø¹Ù†ÙˆØ§Ù† Ø¬Ø¯ÙŠØ¯</div><div><br></div>')">+ Ø¹Ù†ÙˆØ§Ù†</button>
      <button onclick="insertAtCursor('<div class=\\'question-box\\' contenteditable=\\'true\\'>Ø³: Ø§ÙƒØªØ¨ ÙÙŠ ...</div><div><br></div>')">+ Ø³Ø¤Ø§Ù„</button>
      <button onclick="insertAtCursor('<div class=\\'answer-box\\' contenteditable=\\'true\\'>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©:</div><div><br></div>')">+ Ø¥Ø¬Ø§Ø¨Ø©</button>
      <button onclick="document.execCommand('bold')">Ø¹Ø±ÙŠØ¶</button>
      <input type="color" id="colorPicker" title="Ù„ÙˆÙ† Ø§Ù„ÙƒØªØ§Ø¨Ø©">
      <input type="text" id="searchBox" placeholder="Ø¨Ø­Ø«..." oninput="highlightText(this.value)">
    </div>
    <div id="editor"></div>
  </section>

  <script>
    // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    let folders = JSON.parse(localStorage.getItem("folders")) || [];
    let currentFolder = null, currentLesson = null;
    let currentColor = "#000000";

    function saveData() {
      localStorage.setItem("folders", JSON.stringify(folders));
    }

    function showPage(id) {
      document.getElementById("foldersPage").classList.toggle("hidden", id !== "foldersPage");
      document.getElementById("lessonsPage").classList.toggle("hidden", id !== "lessonsPage");
      document.getElementById("editorPage").classList.toggle("hidden", id !== "editorPage");
    }

    // Ù…Ø¬Ù„Ø¯Ø§Øª
    function addFolder() {
      const name = prompt("Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©:");
      if (!name) return;
      folders.push({ name, lessons: [] });
      saveData(); renderFolders();
    }
    function editFolder(i) {
      const newName = prompt("Ø§Ø³Ù… Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…Ø§Ø¯Ø©:", folders[i].name);
      if (newName) { folders[i].name = newName; saveData(); renderFolders(); }
    }
    function deleteFolder(i) {
      if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø§Ø¯Ø©ØŸ")) {
        folders.splice(i,1); saveData(); renderFolders();
      }
    }
    function renderFolders() {
      const list = document.getElementById("foldersList");
      list.innerHTML = "";
      folders.forEach((f,i) => {
        const d = document.createElement("div");
        d.className = "folder";
        d.innerHTML = `<span onclick="openFolder(${i})">${f.name}</span>
          <div class="actions">
            <button onclick="editFolder(${i})">âœï¸</button>
            <button onclick="deleteFolder(${i})">ğŸ—‘ï¸</button>
          </div>`;
        list.appendChild(d);
      });
    }
    function openFolder(i) {
      currentFolder = folders[i];
      document.getElementById("currentFolderTitle").textContent = currentFolder.name;
      renderLessons(); showPage("lessonsPage");
    }
    function backToFolders(){ showPage("foldersPage"); }

    // Ø¯Ø±ÙˆØ³
    function addLesson() {
      const name = prompt("Ø§Ø³Ù… Ø§Ù„Ø¯Ø±Ø³:");
      if (!name) return;
      currentFolder.lessons.push({ name, content: "" });
      saveData(); renderLessons();
    }
    function editLesson(i) {
      const newName = prompt("Ø§Ø³Ù… Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¯Ø±Ø³:", currentFolder.lessons[i].name);
      if (newName) { currentFolder.lessons[i].name = newName; saveData(); renderLessons();}
    }
    function deleteLesson(i) {
      if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¯Ø±Ø³ØŸ")) {
        currentFolder.lessons.splice(i,1); saveData(); renderLessons();
      }
    }
    function renderLessons() {
      const list = document.getElementById("lessonsList");
      list.innerHTML = "";
      currentFolder.lessons.forEach((ls,i)=>{
        const d = document.createElement("div");
        d.className = "lesson";
        d.innerHTML = `<span onclick="openLesson(${i})">${ls.name}</span>
          <div class="actions">
            <button onclick="editLesson(${i})">âœï¸</button>
            <button onclick="deleteLesson(${i})">ğŸ—‘ï¸</button>
          </div>`;
        list.appendChild(d);
      });
    }
    function openLesson(i) {
      currentLesson = currentFolder.lessons[i];
      document.getElementById("editor").innerHTML = currentLesson.content || "";
      showPage("editorPage");
    }
    function backToLessons() {
      if (currentLesson) {
        currentLesson.content = document.getElementById("editor").innerHTML;
        saveData();
      }
      showPage("lessonsPage");
    }

    // Ø¥Ø¯Ø±Ø§Ø¬ HTML ÙÙŠ Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ø¤Ø´Ø±
    function insertAtCursor(html) {
      const sel = window.getSelection();
      if (!sel.rangeCount) return;
      const range = sel.getRangeAt(0);
      const el = document.createElement("div"); el.innerHTML = html;
      const frag = document.createDocumentFragment();
      let node;
      while (node = el.firstChild) frag.appendChild(node);
      range.deleteContents(); range.insertNode(frag);
    }

    // Ø¥Ù†Ø´Ø§Ø¡ ÙÙ‚Ø±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø±
    const editor = document.getElementById("editor");
    editor.addEventListener("click", e => {
      if (e.target === editor) {
        const p = document.createElement("div");
        p.className = "editable-paragraph";
        p.contentEditable = true;
        p.style.color = currentColor;
        p.innerHTML = "";
        editor.appendChild(p);
        p.focus();
      }
    });

    // ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆÙ† Ù„Ù„ØªØ­Ø¯ÙŠØ¯ ÙˆØ§Ù„ÙƒØªØ§Ø¨Ø©
    document.getElementById("colorPicker")
      .addEventListener("input", e => {
        currentColor = e.target.value;
        document.execCommand("styleWithCSS",false,true);
        document.execCommand("foreColor",false,currentColor);
      });

    // Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØ¸Ù„ÙŠÙ„
    function highlightText(term) {
      const raw = editor.innerHTML.replace(/<mark>|<\/mark>/g,"");
      if (term.trim() === "") {
        editor.innerHTML = raw;
      } else {
        const regex = new RegExp(term,"gi");
        editor.innerHTML = raw.replace(regex,"<mark>$&</mark>");
      }
    }

    renderFolders();
    showPage("foldersPage");
  </script>
</body>
</html>
